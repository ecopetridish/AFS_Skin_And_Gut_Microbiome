"0","# Plot gut and skin relative abundances"
"0","## Get unique phylum levels for skin and gut"
"0","length(unique(plot$phylum)) #15"
"1","[1]"
"1"," 15"
"1","
"
"0","## Define the colors to use"
"0","pal1<-brewer.pal(n = 11, name = ""BrBG"")"
"0","pal1<-replace(pal1, pal1==""#F5F5F5"",""#a6bddb"")"
"0","pal2<-brewer.pal(n = 4, name = ""PiYG"")"
"0","pal2<-replace(pal2, pal2==""#4DAC26"",""#e0f3db"")"
"0","myColors<-c(pal1, pal2)"
"0",""
"0","## Set the colors with names"
"0","names(myColors)<-levels(as.factor(plot$phylum))"
"0","names_phylum<-sort(unique(plot$phylum)) #15"
"0",""
"0","# Define the order of pair_ids"
"0","pairid_order<-paste0(""P"",1:20)"
"0","plot$Pair_ID<-factor(plot$Pair_ID, levels = pairid_order)"
"0",""
"0","## Plot rel. abundance"
"0","p1<-plot %>% "
"0","  filter(Type_2 == ""Skin"") %>%"
"0","  mutate(phylum = factor(phylum, levels = names_phylum)) %>% "
"0","  ggplot(aes(x = Pair_ID, y = Abundance, fill = phylum)) +      "
"0","  facet_grid(Age ~ Colony, scales = ""free_x"") + "
"0","  geom_bar(stat = ""identity"", width = 0.9, show.legend = TRUE) +"
"0","  theme_classic() +"
"0","  ggtitle(""A) Skin"") +"
"0","  theme(strip.background = element_blank(), "
"0","        strip.text.x = element_text(size = 16, vjust = -1.4), "
"0","        strip.text.y = element_blank(),"
"0","        axis.line = element_blank(), "
"0","        axis.text.x = element_blank(),"
"0","        axis.text.y = element_text(size = 14),"
"0","        axis.ticks = element_blank(), "
"0","        axis.title.x = element_blank(), "
"0","        axis.title.y = element_text(size = 18),"
"0","        plot.title = element_text(size = 18, vjust = -1), "
"0","        panel.spacing = unit(0, ""lines""),"
"0","        legend.text = element_text(size = 16),"
"0","        legend.title = element_text(size = 16)) +"
"0","  scale_fill_manual(values = myColors, name = ""Phylum"", drop = FALSE) + "
"0","  ylab(""Relative abundance"")"
"0",""
"0","p2<-plot %>% "
"0","  dplyr::filter(Type_2 == ""Gut"") %>%"
"0","  mutate(Age = dplyr::recode(Age, Mother = ""Mothers"", Pup = ""Pups"")) %>% "
"0","  mutate(phylum = factor(phylum, levels = names_phylum)) %>% "
"0","  ggplot(aes(x = Pair_ID, y = Abundance, fill = phylum)) +      "
"0","  facet_grid(Age ~ Colony, scales = ""free_x"") + "
"0","  geom_bar(stat = ""identity"", width = 0.9, show.legend = TRUE) +"
"0","  theme_classic() +"
"0","  ggtitle(""B) Gut"") +"
"0","  theme(strip.background = element_blank(), "
"0","        strip.text.x = element_text(size = 16, vjust = -1.4), "
"0","        strip.text.y = element_text(size = 16),"
"0","        axis.line = element_blank(), "
"0","        axis.text.x = element_blank(),"
"0","        axis.text.y = element_blank(),"
"0","        axis.ticks = element_blank(), "
"0","        axis.title.x = element_blank(), "
"0","        axis.title.y = element_blank(),"
"0","        plot.title = element_text(size = 18, vjust = -1), "
"0","        panel.spacing = unit(0, ""lines""),"
"0","        legend.text = element_text(size = 16),"
"0","        legend.title = element_text(size = 16)) +"
"0","  scale_fill_manual(values = myColors, name = ""Phylum"", drop = FALSE) + "
"0","  ylab("""")"
"0",""
"0","# Combine plots with patchwork"
"0","combined_plot<-p1 + p2 + plot_layout(guides = ""collect"")"
"0",""
"0","# Draw x title with some background "
"0","x_title<-ggdraw() + "
"0","           draw_label(""Mother-pup pair"", size = 18, hjust = 1.1, y = 1.2, fontfamily = ""Arial"") +"
"0","           theme(panel.background = element_rect(fill = ""White"", color = ""White""))"
"0","# Plot it"
"0","plot_grid(combined_plot, "
"0","          x_title, "
"0","          nrow = 2, "
"0","          rel_heights = c(4, 0.1))"
